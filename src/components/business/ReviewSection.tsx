import { useState } from \"react\";\nimport { Star, MessageSquare, ThumbsUp, ThumbsDown, Flag, Send } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Review {\n  id: string;\n  author: string;\n  rating: number;\n  title: string;\n  content: string;\n  date: Date;\n  helpful: number;\n  images?: string[];\n  verified: boolean;\n}\n\ninterface ReviewModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  shopName: string;\n  onSubmitReview: (review: Omit<Review, \"id\" | \"date\" | \"author\" | \"helpful\">) => void;\n}\n\nconst SAMPLE_REVIEWS: Review[] = [\n  {\n    id: \"1\",\n    author: \"Sarah M.\",\n    rating: 5,\n    title: \"Excellent Service!\",\n    content: \"Had a wonderful experience at this shop. The staff was very helpful and friendly. Highly recommended!\",\n    date: new Date(Date.now() - 86400000),\n    helpful: 24,\n    verified: true,\n  },\n  {\n    id: \"2\",\n    author: \"John D.\",\n    rating: 4,\n    title: \"Great Quality, Good Prices\",\n    content: \"Good selection of products and reasonable prices. Will definitely visit again.\",\n    date: new Date(Date.now() - 172800000),\n    helpful: 18,\n    verified: true,\n  },\n  {\n    id: \"3\",\n    author: \"Emily R.\",\n    rating: 5,\n    title: \"Amazing Experience\",\n    content: \"The booking process was smooth and the service was excellent. Highly satisfied!\",\n    date: new Date(Date.now() - 259200000),\n    helpful: 32,\n    verified: true,\n  },\n  {\n    id: \"4\",\n    author: \"Michael T.\",\n    rating: 3,\n    title: \"Average Service\",\n    content: \"The service was okay, but the wait time was a bit long.\",\n    date: new Date(Date.now() - 345600000),\n    helpful: 8,\n    verified: true,\n  },\n];\n\nexport const ReviewSection = () => {\n  const [reviews, setReviews] = useState<Review[]>(SAMPLE_REVIEWS);\n  const [showReviewModal, setShowReviewModal] = useState(false);\n  const [sortBy, setSortBy] = useState<\"recent\" | \"helpful\" | \"rating\">(\"recent\");\n  const { toast } = useToast();\n\n  const handleHelpful = (reviewId: string) => {\n    setReviews((prev) =>\n      prev.map((review) =>\n        review.id === reviewId ? { ...review, helpful: review.helpful + 1 } : review\n      )\n    );\n    toast({ description: \"ðŸ‘ Thanks for your feedback!\" });\n  };\n\n  const handleReportReview = (reviewId: string) => {\n    toast({ description: \"ðŸš¨ Review reported. Thank you!\" });\n  };\n\n  const handleSubmitReview = (review: Omit<Review, \"id\" | \"date\" | \"author\" | \"helpful\">) => {\n    const newReview: Review = {\n      ...review,\n      id: Date.now().toString(),\n      author: \"You\",\n      date: new Date(),\n      helpful: 0,\n    };\n    setReviews((prev) => [newReview, ...prev]);\n    setShowReviewModal(false);\n    toast({ title: \"Review Posted\", description: \"Your review has been submitted!\" });\n  };\n\n  const getSortedReviews = () => {\n    const sorted = [...reviews];\n    if (sortBy === \"helpful\") {\n      return sorted.sort((a, b) => b.helpful - a.helpful);\n    } else if (sortBy === \"rating\") {\n      return sorted.sort((a, b) => b.rating - a.rating);\n    }\n    return sorted.sort((a, b) => b.date.getTime() - a.date.getTime());\n  };\n\n  const averageRating =\n    reviews.length > 0\n      ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1)\n      : 0;\n\n  const ratingDistribution = {\n    5: reviews.filter((r) => r.rating === 5).length,\n    4: reviews.filter((r) => r.rating === 4).length,\n    3: reviews.filter((r) => r.rating === 3).length,\n    2: reviews.filter((r) => r.rating === 2).length,\n    1: reviews.filter((r) => r.rating === 1).length,\n  };\n\n  const formatDate = (date: Date) => {\n    const now = new Date();\n    const diff = now.getTime() - date.getTime();\n    const days = Math.floor(diff / (1000 * 60 * 60 * 24));\n    if (days === 0) return \"Today\";\n    if (days === 1) return \"Yesterday\";\n    if (days < 7) return `${days} days ago`;\n    return date.toLocaleDateString();\n  };\n\n  return (\n    <div className=\"w-full\">\n      {/* Rating Summary */}\n      <div className=\"bg-white dark:bg-slate-800 rounded-2xl p-6 mb-6 border border-primary/10\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-6\">\n          {/* Overall Rating */}\n          <div className=\"text-center\">\n            <div className=\"text-4xl font-black text-primary mb-2\">{averageRating}</div>\n            <div className=\"flex justify-center gap-1 mb-2\">\n              {[...Array(5)].map((_, i) => (\n                <Star\n                  key={i}\n                  className={`w-4 h-4 ${\n                    i < Math.floor(Number(averageRating))\n                      ? \"fill-yellow-400 text-yellow-400\"\n                      : \"text-slate-300 dark:text-slate-600\"\n                  }`}\n                />\n              ))}\n            </div>\n            <p className=\"text-sm text-slate-600 dark:text-slate-400\">\n              Based on {reviews.length} review{reviews.length !== 1 ? \"s\" : \"\"}\n            </p>\n          </div>\n\n          {/* Rating Distribution */}\n          <div className=\"sm:col-span-2 space-y-2\">\n            {[5, 4, 3, 2, 1].map((rating) => (\n              <div key={rating} className=\"flex items-center gap-2\">\n                <span className=\"text-sm font-semibold text-slate-600 dark:text-slate-400 w-6\">\n                  {rating}â˜…\n                </span>\n                <div className=\"flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-gradient-to-r from-yellow-400 to-amber-500 transition-all\"\n                    style={{\n                      width: `${reviews.length > 0 ? (ratingDistribution[rating as keyof typeof ratingDistribution] / reviews.length) * 100 : 0}%`,\n                    }}\n                  />\n                </div>\n                <span className=\"text-sm text-slate-600 dark:text-slate-400 w-8\">\n                  {ratingDistribution[rating as keyof typeof ratingDistribution]}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/* Reviews Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 mb-6\">\n        <h3 className=\"text-xl font-bold text-slate-900 dark:text-white\">Customer Reviews</h3>\n        <div className=\"flex gap-2\">\n          <select\n            value={sortBy}\n            onChange={(e) => setSortBy(e.target.value as \"recent\" | \"helpful\" | \"rating\")}\n            className=\"px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white text-sm font-medium\"\n          >\n            <option value=\"recent\">Most Recent</option>\n            <option value=\"helpful\">Most Helpful</option>\n            <option value=\"rating\">Highest Rated</option>\n          </select>\n          <Button\n            className=\"bg-gradient-to-r from-primary to-accent text-white rounded-lg font-bold\"\n            onClick={() => setShowReviewModal(true)}\n          >\n            Write Review\n          </Button>\n        </div>\n      </div>\n\n      {/* Reviews List */}\n      <div className=\"space-y-4\">\n        {getSortedReviews().map((review) => (\n          <div\n            key={review.id}\n            className=\"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700 hover:border-primary/30 transition-colors\"\n          >\n            {/* Header */}\n            <div className=\"flex items-start justify-between mb-2\">\n              <div>\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <span className=\"font-bold text-slate-900 dark:text-white\">{review.author}</span>\n                  {review.verified && (\n                    <span className=\"text-xs bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 px-2 py-0.5 rounded-full font-semibold\">\n                      Verified\n                    </span>\n                  )}\n                </div>\n                <p className=\"text-sm text-slate-600 dark:text-slate-400\">{formatDate(review.date)}</p>\n              </div>\n              <div className=\"flex gap-1\">\n                {[...Array(5)].map((_, i) => (\n                  <Star\n                    key={i}\n                    className={`w-4 h-4 ${\n                      i < review.rating\n                        ? \"fill-yellow-400 text-yellow-400\"\n                        : \"text-slate-300 dark:text-slate-600\"\n                    }`}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Title & Content */}\n            <h4 className=\"font-bold text-slate-900 dark:text-white mb-1\">{review.title}</h4>\n            <p className=\"text-sm text-slate-700 dark:text-slate-300 mb-3\">{review.content}</p>\n\n            {/* Footer */}\n            <div className=\"flex items-center gap-3\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"px-2 text-slate-600 dark:text-slate-400 hover:text-primary hover:bg-primary/10\"\n                onClick={() => handleHelpful(review.id)}\n              >\n                <ThumbsUp className=\"w-4 h-4 mr-1\" />\n                Helpful ({review.helpful})\n              </Button>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"px-2 text-slate-600 dark:text-slate-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-950/30\"\n                onClick={() => handleReportReview(review.id)}\n              >\n                <Flag className=\"w-4 h-4 mr-1\" />\n                Report\n              </Button>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Review Modal */}\n      <ReviewModal\n        isOpen={showReviewModal}\n        onClose={() => setShowReviewModal(false)}\n        shopName=\"Shop\"\n        onSubmitReview={handleSubmitReview}\n      />\n    </div>\n  );\n};\n\nconst ReviewModal = ({\n  isOpen,\n  onClose,\n  shopName,\n  onSubmitReview,\n}: ReviewModalProps) => {\n  const [rating, setRating] = useState(5);\n  const [title, setTitle] = useState(\"\");\n  const [content, setContent] = useState(\"\");\n\n  const handleSubmit = () => {\n    if (!title.trim() || !content.trim()) {\n      alert(\"Please fill in all fields\");\n      return;\n    }\n    onSubmitReview({ rating, title, content, verified: false });\n    setRating(5);\n    setTitle(\"\");\n    setContent(\"\");\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Write a Review</DialogTitle>\n          <DialogDescription>Share your experience with {shopName}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          {/* Rating */}\n          <div>\n            <label className=\"block font-bold text-slate-900 dark:text-white mb-2\">\n              Rating\n            </label>\n            <div className=\"flex gap-2\">\n              {[1, 2, 3, 4, 5].map((star) => (\n                <button\n                  key={star}\n                  onClick={() => setRating(star)}\n                  className=\"focus:outline-none transition-transform hover:scale-110\"\n                >\n                  <Star\n                    className={`w-8 h-8 ${\n                      star <= rating\n                        ? \"fill-yellow-400 text-yellow-400\"\n                        : \"text-slate-300 dark:text-slate-600\"\n                    }`}\n                  />\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Title */}\n          <div>\n            <label className=\"block font-bold text-slate-900 dark:text-white mb-2\">\n              Title\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Summary of your experience\"\n              value={title}\n              onChange={(e) => setTitle(e.target.value)}\n              className=\"w-full px-3 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-900 dark:text-white\"\n            />\n          </div>\n\n          {/* Content */}\n          <div>\n            <label className=\"block font-bold text-slate-900 dark:text-white mb-2\">\n              Review\n            </label>\n            <Textarea\n              placeholder=\"Share your detailed experience...\"\n              value={content}\n              onChange={(e) => setContent(e.target.value)}\n              className=\"w-full\"\n            />\n          </div>\n        </div>\n\n        <div className=\"flex gap-2\">\n          <Button variant=\"outline\" className=\"flex-1\" onClick={onClose}>\n            Cancel\n          </Button>\n          <Button\n            className=\"flex-1 bg-gradient-to-r from-primary to-accent text-white\"\n            onClick={handleSubmit}\n          >\n            <Send className=\"w-4 h-4 mr-2\" />\n            Post Review\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default ReviewSection;\n